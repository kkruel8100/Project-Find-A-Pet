<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Firebase</title>
	<!-- Custom CSS -->
	<link rel="stylesheet" type="text/css" href="NYT_style.css">

</head>
<body>

	<h3>Firebase</h3>

	<div class="row"><!--Start of Add a Pet -->
	    <div class="col-sm-12">
			<div class="card">
  				<h4 class="card-header">Add A Pet</h4>
  				<div class="card-body">
					<form id="addPet">
						  <div class="form-group">
		    				<label for="Select">Lost/Found</label>
		    				<select class="form-control" id="lostFound_input">
		    					<option>Lost</option>
		    					<option>Found</option>
			      			</select>
		  				  </div>
						  <div class="form-group">
						    <label>Pet Name</label>
						    <input type="text" class="form-control" id="name_input"></input>
						  </div>
		<!--Update id names when moved to new html page - Not able to populate two ids on same page - Impacts both click functions-->
		<!--May decide to keep two set of ids-->
						  <div class="form-group">
			    			<label for="Select">Animal</label>
			    			<select class="form-control" id="animalUpdate">
			    			<option>cat</option>
			    			<option>dog</option>
				      		</select>
		  				  </div>
					 	  <div class="form-group">
				    		<label for="Select">Size</label>
				    		<select class="form-control" id="sizeUpdate">
				    		<option>S</option>
				    		<option>M</option>
				    		<option>L</option>
				    		<option>XL</option>
				    		</select>
						  </div>
				  		  <div class="form-group">
		    				<label for="Select">Sex</label>
		    				<select class="form-control" id="sexUpdate">
		    				<option>F</option>
		    				<option>M</option>
		    				</select>
				  		  </div>
				  	      <div class="form-group">
		    				<label for="Select">Age</label>
		    			    <select class="form-control" id="ageUpdate">
		    			    <option>Baby</option>
		    			    <option>Young</option>
		    			    <option>Adult</option>
		    			    <option>Senior</option>
		    			    </select>
				  		  </div>
						  
						  <div class="form-group">
						    <label>Zip Code</label>
						    <input type="text" class="form-control" id="zipUpdate"></input>
						  </div>
						  <button id="submit" type="submit" class="btn btn-primary">Submit</button>
					</form><!--end of form -->
				</div><!--end of card body -->
	      	</div><!--end of card -->
	    </div>
	<div class="row"><!--Start of Lost-Found Results-->
	    <div class="col-sm-12">
	    	<div class="card">
  				<h4 class="card-header">Lost and Found Database</h4>
  				<div class="card-body">
					<table class="table">
					  <thead>
					    <tr>
					      <th>Lost or Found</th> 
					      <th>Pet Name</th>
					      <th>Animal</th>
					      <th>Size</th>
					      <th>Sex</th>
					      <th>Age</th>
					      <th>Zip Code</th>
					      <th>Edit</th>
					      <th>Delete</th>
					    </tr>
					  </thead>
					  <tbody id="petList">  
					  </tbody>
					</table>

				</div><!--end of card body -->
			</div><!--end of card -->
	    </div>
	  </div><!--End of Lost-Found Results-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- Firebase Javascript -->
	<script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
    <script>
	  // Initialize Firebase
	  var config = {
	    apiKey: "AIzaSyDv05y1-GztFyliR0L42WZll3Le0lQxoyk",
	    authDomain: "project-find-a-pet.firebaseapp.com",
	    databaseURL: "https://project-find-a-pet.firebaseio.com",
	    projectId: "project-find-a-pet",
	    storageBucket: "project-find-a-pet.appspot.com",
	    messagingSenderId: "1054405260043"
	  };
	  firebase.initializeApp(config);

	  //Search Found/Lost variables
	  var lostAndFound = ["Found", "Lost"];
	  var lFname = "";
	  var lFanimal = "";
	  var lFsex = "";
	  var lFsize = "";
	  var lFage = "";		
	  var database = firebase.database();

	  // Capture Add a Pet Click
  	  $("#submit").on("click", function(event) {
    	event.preventDefault();
		//Need to check ids if update form when new page is added  
	    lostAndFound = $("#lostFound_input").val();
	    lFname = $("#name_input").val().trim();    
	    lFanimal = $("#animalUpdate").val();
	    lFsize = $("#sizeUpdate").val();
	    lFsex = $("#sexUpdate").val();
	    lFage = $("#ageUpdate").val();
	    lFzip = $("#zipUpdate").val().trim();

    	if (lFzip.length===5 && lFname.length >= 1) {

	      // Code for the push
	      database.ref().push({
	        lostAndFound: lostAndFound,
	        lFname: lFname,
	        lFanimal: lFanimal,
	        lFsize: lFsize,
	        lFsex: lFsex,
	        lFage: lFage,
	        lFzip: lFzip,
	        dateAdded: firebase.database.ServerValue.TIMESTAMP
	      });

	      

	      // Code to clear input fields
	      // clearField();
	    }//end of if

		//Need to replace alert with Modal JS    
	    else {
	      alert("Please verify name and zip")
	    }//end of else

	  });//end of click

      // Update Pet List
      database.ref().on("child_added", function(childSnapshot) {
      	
        // full list of pets
        id = childSnapshot.key;//captures unique key value
        
	    $("#petList").append("<tr><td> " + childSnapshot.val().lostAndFound +
	      " </td><td> " + childSnapshot.val().lFname +
	      " </td><td> " + childSnapshot.val().lFanimal +
	      " </td><td> " + childSnapshot.val().lFsize +
	      " </td><td> " + childSnapshot.val().lFsex +
	      " </td><td> " + childSnapshot.val().lFage +
	      " </td><td> " + childSnapshot.val().lFzip +
	      " </td><td> " + "<button class=edit style='background: url(icons/edit.png)'></button>" +
	      " </td><td> " + "<button id='"+id+"'class=delete style='background: url(icons/remove.png)'></button>" + " </td></tr>");

	      // Handle the errors
	  }, function(errorObject) {
	    console.log("Errors handled: " + errorObject.code);
	    });

      $(document).on("click", ".delete", function(event) {
      	var childKey = this.id;
      	console.log(childKey)
      	if (confirm("Are you sure you want to delete this notification?") === true) {
        alert("Removed: " + childKey);
        database.ref(childKey).remove();
        $(this).closest("tr").remove();
        
      } else {
        alert("Cancelled");
      }
});



</script>
</body>
</html>